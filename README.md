# Paddy Irrigation Agent

This repository contains code for training and evaluating a **behaviour-cloned controller** for a simplified paddy-field irrigation system. The agent learns from actions generated by a calibrated rule-based controller and outputs daily irrigation and drainage decisions.

---

## Project Structure

* **`config.yaml`** – central configuration (features, actions, training params, stage targets).
* **`train_bc.py`** – trains a behaviour cloning (BC) model from merged training data.
* **`policy.py`** – helper functions for loading/saving policy tables and applying decisions.
* **`export_policy_table.py`** – exports the trained model as a policy lookup table (CSV).
* **`export_policy_grid.py`** – generates a grid of state–action pairs for analysis or NetLogo.
* **`merge_data.py`** – combines multiple rollout CSVs (from NetLogo) into a single dataset.
* **`diagnostics.py`** – tools for analysing training data, policies, and model behaviour.
* **`requirements.txt`** – Python dependencies.


---

## Usage

1. **Prepare data**
   Place rollout CSVs from NetLogo (`rule_ep*.csv`) into a `data/` folder.
   Run:

   ```bash
   python merge_data.py
   ```

   → Produces `data/merged_dataset.csv`.

2. **Train agent**

   ```bash
   python train_bc.py
   ```

   → Saves model (`models/bc_model.joblib`) and metadata (`models/bc_meta.json`).

3. **Export policy**
   For NetLogo integration:

   ```bash
   python export_policy_table.py
   ```

   → Writes `models/policy_table.csv`.

4. **Run diagnostics (optional)**

   ```bash
   python diagnostics.py
   ```

---

## Configuration

All key parameters (features, actions, training hyperparameters, stage durations) are defined in **`config.yaml`**. Example:

```yaml
stage_durations: [7, 10, 21, 14, 24, 35, 10, 30]
drain_stages: [3, 7]
flood_stages: [1, 2, 5]
model:
  type: "random_forest"
  n_estimators: 300
  max_depth: 12
```

---

## Requirements

* Python 3.9+
* pandas, numpy, scikit-learn, pyyaml, joblib (see `requirements.txt`)

---

## Notes

* The agent is trained offline (supervised BC), not through reinforcement learning.
* Exported policy is used by NetLogo (`policy_table.csv`) to drive irrigation decisions.
* Data must be consistent with NetLogo logging format (`delta_lake_L`, `irrigateN_mm`, etc.).

